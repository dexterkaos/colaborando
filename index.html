<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cuestionario HTML y CSS - Modelo de Cajas</title>
    <!-- EmailJS Library -->
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
    <style>
    * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    }

    body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    min-height: 100vh;
    padding: 20px;
    color: #333;
    }

    .container {
    max-width: 800px;
    margin: 0 auto;
    background: white;
    border-radius: 15px;
    box-shadow: 0 20px 40px rgba(0,0,0,0.1);
    overflow: hidden;
    }

    .header {
    background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
    color: white;
    padding: 30px;
    text-align: center;
    }

    .header h1 {
    font-size: 2.2em;
    margin-bottom: 10px;
    font-weight: 600;
    }

    .header p {
    font-size: 1.1em;
    opacity: 0.9;
    }

    .timer-progress {
    background: #f8f9fa;
    padding: 20px;
    border-bottom: 1px solid #e9ecef;
    }

    .timer {
    text-align: center;
    font-size: 1.5em;
    font-weight: bold;
    color: #dc3545;
    margin-bottom: 15px;
    }

    .progress-container {
    background: #e9ecef;
    border-radius: 10px;
    height: 20px;
    overflow: hidden;
    margin-bottom: 10px;
    }

    .progress-bar {
    background: linear-gradient(90deg, #28a745, #20c997);
    height: 100%;
    width: 0%;
    transition: width 0.3s ease;
    border-radius: 10px;
    }

    .progress-text {
    text-align: center;
    font-weight: 500;
    color: #6c757d;
    }

    .form-section {
    padding: 30px;
    }

    .student-info {
    margin-bottom: 30px;
    padding: 20px;
    background: #f8f9fa;
    border-radius: 10px;
    border-left: 4px solid #007bff;
    }

    .student-info label {
    display: block;
    font-weight: 600;
    margin-bottom: 8px;
    color: #495057;
    }

    .student-info input {
    width: 100%;
    padding: 12px;
    border: 2px solid #dee2e6;
    border-radius: 8px;
    font-size: 1em;
    transition: border-color 0.3s ease;
    }

    .student-info input:focus {
    outline: none;
    border-color: #007bff;
    box-shadow: 0 0 0 3px rgba(0,123,255,0.25);
    }

    .question {
    margin-bottom: 30px;
    padding: 25px;
    background: #fff;
    border: 2px solid #e9ecef;
    border-radius: 12px;
    transition: all 0.3s ease;
    }

    .question:hover {
    border-color: #007bff;
    box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    }

    .question-title {
    font-size: 1.2em;
    font-weight: 600;
    margin-bottom: 20px;
    color: #2c3e50;
    line-height: 1.4;
    }

    .question-number {
    background: #007bff;
    color: white;
    padding: 5px 12px;
    border-radius: 20px;
    font-size: 0.9em;
    font-weight: 600;
    margin-right: 10px;
    }

    .options {
    display: grid;
    gap: 12px;
    }

    .option {
    display: flex;
    align-items: center;
    padding: 15px;
    background: #f8f9fa;
    border: 2px solid #e9ecef;
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.3s ease;
    min-height: 44px;
    }

    .option:hover {
    background: #e3f2fd;
    border-color: #2196f3;
    }

    .option input[type="radio"] {
    margin-right: 12px;
    transform: scale(1.2);
    }

    .option label {
    cursor: pointer;
    flex: 1;
    font-size: 1em;
    line-height: 1.4;
    }

    .option.correct {
    background: #d4edda;
    border-color: #28a745;
    color: #155724;
    }

    .option.incorrect {
    background: #f8d7da;
    border-color: #dc3545;
    color: #721c24;
    }

    .option.correct::after {
    content: "✓";
    color: #28a745;
    font-weight: bold;
    font-size: 1.2em;
    margin-left: auto;
    }

    .option.incorrect::after {
    content: "✗";
    color: #dc3545;
    font-weight: bold;
    font-size: 1.2em;
    margin-left: auto;
    }

    .submit-section {
    text-align: center;
    padding: 30px;
    background: #f8f9fa;
    border-top: 1px solid #e9ecef;
    }

    .submit-btn {
    background: linear-gradient(135deg, #28a745, #20c997);
    color: white;
    padding: 15px 40px;
    border: none;
    border-radius: 25px;
    font-size: 1.1em;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 0 4px 15px rgba(40,167,69,0.3);
    }

    .submit-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(40,167,69,0.4);
    }

    .submit-btn:disabled {
    background: #6c757d;
    cursor: not-allowed;
    transform: none;
    box-shadow: none;
    }

    .results {
    display: none;
    padding: 30px;
    background: #f8f9fa;
    border-top: 1px solid #e9ecef;
    }

    .results.show {
    display: block;
    }

    .score-card {
    background: white;
    padding: 30px;
    border-radius: 15px;
    text-align: center;
    margin-bottom: 30px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.1);
    }

    .score-value {
    font-size: 3em;
    font-weight: bold;
    margin-bottom: 10px;
    }

    .score-excellent { color: #28a745; }
    .score-good { color: #17a2b8; }
    .score-acceptable { color: #ffc107; }
    .score-insufficient { color: #fd7e14; }
    .score-deficient { color: #dc3545; }

    .score-status {
    font-size: 1.3em;
    font-weight: 600;
    margin-bottom: 15px;
    }

    .score-details {
    color: #6c757d;
    font-size: 1.1em;
    }

    .toast {
    position: fixed;
    top: 20px;
    right: 20px;
    background: #dc3545;
    color: white;
    padding: 15px 25px;
    border-radius: 8px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.2);
    z-index: 1000;
    transform: translateX(400px);
    transition: transform 0.3s ease;
    }

    .toast.show {
    transform: translateX(0);
    }

    .error-message {
    color: #dc3545;
    font-size: 0.9em;
    margin-top: 5px;
    display: none;
    }

    @media (max-width: 768px) {
    .container {
    margin: 10px;
    border-radius: 10px;
    }
    
    .header {
    padding: 20px;
    }
    
    .header h1 {
    font-size: 1.8em;
    }
    
    .form-section {
    padding: 20px;
    }
    
    .question {
    padding: 20px;
    margin-bottom: 20px;
    }
    
    .question-title {
    font-size: 1.1em;
    }
    }

    @media (prefers-reduced-motion: reduce) {
    * {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
    }
    }
    </style>
</head>
<body>
    <div class="container">
    <div class="header">
    <h1>Cuestionario HTML y CSS</h1>
    <p>Cuestionario Diseño Web</p>
    </div>

    <div class="timer-progress">
    <div class="timer" id="timer" aria-live="polite">15:00</div>
    <div class="progress-container">
    <div class="progress-bar" id="progressBar"></div>
    </div>
    <div class="progress-text" id="progressText">0/20 preguntas respondidas</div>
    </div>

    <form id="quizForm">
    <div class="form-section">
    <div class="student-info">
    <label for="studentName">Nombre completo del estudiante *</label>
    <input type="text" id="studentName" name="studentName" required>
    <div class="error-message" id="nameError">Por favor, ingresa tu nombre completo.</div>
    </div>

    <div id="questionsContainer"></div>
    </div>

    <div class="submit-section">
    <button type="button" class="submit-btn" id="submitBtn">Enviar Respuestas</button>
    </div>
    </form>

    <div class="results" id="results">
    <div class="score-card" id="scoreCard">
    <div class="score-value" id="scoreValue">0.0</div>
    <div class="score-status" id="scoreStatus">CALIFICANDO...</div>
    <div class="score-details" id="scoreDetails">Procesando resultados...</div>
    </div>
    </div>
    </div>

    // Configuración de EmailJS - con datos provistos
    const EMAIL_CONFIG = {
      SERVICE_ID: 'evaluacion.actividades84@gmail.com',
      TEMPLATE_ID: 'template_ft7xqbd',
      PUBLIC_KEY: 'QL4lenSWmrpw188qH',
      TO_EMAIL: 'evaluacion.actividades84@gmail.com'
    };

    // Inicializar EmailJS de forma segura
    try {
      if (typeof emailjs !== 'undefined') {
        emailjs.init(EMAIL_CONFIG.PUBLIC_KEY);
        console.log('EmailJS inicializado');
      } else {
        console.warn('EmailJS no está cargado');
      }
    } catch (e) {
      console.warn('No se pudo inicializar EmailJS', e);
    }

    <div class="toast" id="toast" role="alert" aria-live="assertive"></div>

    <script>
    // Configuración del cuestionario
    const CONFIG = {
    DURATION: 900, // 15 minutos en segundos
    TOTAL_QUESTIONS: 20,
    POINTS_PER_QUESTION: 0.25,
    PASSING_GRADE: 3.5
    };

    // Base de datos de preguntas
    const questions = [
    {
    question: "¿Cuál es la etiqueta HTML correcta para crear un encabezado principal?",
    options: ["<header>", "<h1>", "<title>", "<head>"],
    correct: 1
    },
    {
    question: "¿Qué atributo se utiliza en la etiqueta <img> para especificar la ruta de la imagen?",
    options: ["href", "src", "link", "url"],
    correct: 1
    },
    {
    question: "¿Cuál es el valor correcto del atributo target para abrir un enlace en una nueva pestaña?",
    options: ["_new", "_blank", "_tab", "_window"],
    correct: 1
    },
    {
    question: "¿Cuál de las siguientes etiquetas se utiliza para crear un párrafo en HTML?",
    options: ["<paragraph>", "<text>", "<p>", "<para>"],
    correct: 2
    },
    {
    question: "¿Qué etiqueta HTML se utiliza para crear una lista ordenada?",
    options: ["<ul>", "<ol>", "<list>", "<order>"],
    correct: 1
    },
    {
    question: "¿Cuál es el atributo correcto para proporcionar texto alternativo en una imagen?",
    options: ["title", "alt", "description", "text"],
    correct: 1
    },
    {
    question: "¿Dónde se debe colocar la etiqueta <style> para CSS interno en un documento HTML?",
    options: ["En el <body>", "En el <head>", "Al final del documento", "En cualquier lugar"],
    correct: 1
    },
    {
    question: "¿Qué atributo se añade a la etiqueta <video> para mostrar los controles de reproducción?",
    options: ["controls", "play", "buttons", "interface"],
    correct: 0
    },
    {
    question: "¿Cuál es la etiqueta correcta para crear una celda de datos en una tabla HTML?",
    options: ["<cell>", "<data>", "<td>", "<tc>"],
    correct: 2
    },
    {
    question: "¿Qué atributo del elemento <label> se utiliza para asociarlo con un campo de formulario?",
    options: ["id", "for", "name", "target"],
    correct: 1
    },
    {
    question: "En CSS, ¿qué propiedad se utiliza para establecer el grosor del borde de un elemento?",
    options: ["border-size", "border-width", "border-thickness", "border-weight"],
    correct: 1
    },
    {
    question: "¿Cuál es la propiedad CSS correcta para establecer el margen inferior de un elemento?",
    options: ["margin-down", "margin-bottom", "bottom-margin", "margin-lower"],
    correct: 1
    },
    {
    question: "¿Cuál es la sintaxis correcta para establecer padding de 10px en todos los lados usando CSS abreviado?",
    options: ["padding: 10px 10px 10px 10px;", "padding: 10px;", "padding: all 10px;", "padding: 10px each;"],
    correct: 1
    },
    {
    question: "En el modelo de cajas CSS, ¿cuál es el orden correcto de las capas desde el contenido hacia afuera?",
    options: ["contenido → border → padding → margin", "contenido → margin → padding → border", "contenido → padding → border → margin", "contenido → padding → margin → border"],
    correct: 2
    },
    {
    question: "¿Qué propiedad CSS se utiliza para cambiar el color del texto?",
    options: ["text-color", "font-color", "color", "text-style"],
    correct: 2
    },
    {
    question: "¿Cuál es la ruta correcta para referenciar una imagen llamada 'logo.png' que está en la carpeta 'images'?",
    options: ["images/logo.png", "/images/logo.png", "images\\logo.png", "logo.png/images"],
    correct: 0
    },
    {
    question: "¿Cuál de las siguientes etiquetas es un elemento de bloque por defecto?",
    options: ["<span>", "<a>", "<h2>", "<strong>"],
    correct: 2
    },
    {
    question: "¿Qué etiqueta HTML se utiliza para agrupar el contenido del cuerpo de una tabla?",
    options: ["<table-body>", "<tbody>", "<body>", "<table-content>"],
    correct: 1
    },
    {
    question: "¿Cuál es la principal diferencia entre margin y padding en CSS?",
    options: ["No hay diferencia", "Margin es interno, padding es externo", "Padding es interno, margin es externo", "Margin es para texto, padding para imágenes"],
    correct: 2
    },
    {
    question: "¿Cuál de las siguientes etiquetas es un elemento en línea (inline) por defecto?",
    options: ["<div>", "<p>", "<span>", "<h1>"],
    correct: 2
    }
    ];

    // Variables globales
    let timeRemaining = CONFIG.DURATION;
    let timerInterval;
    let startTime;
    let shuffledQuestions = [];
    let userAnswers = {};
    let isSubmitted = false;

    // Funciones de utilidad
    function shuffleArray(array) {
    const shuffled = [...array];
    for (let i = shuffled.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
    }
    return shuffled;
    }

    // Escapar caracteres especiales para evitar interpretación HTML en preguntas/opciones
    function escapeHTML(str) {
    return String(str)
    .replace(/&/g, '&amp;')
    .replace(/</g, '&lt;')
    .replace(/>/g, '&gt;')
    .replace(/"/g, '&quot;')
    .replace(/'/g, '&#39;');
    }


    function validateQuestions() {
    const errors = [];
    questions.forEach((q, index) => {
    if (!q.question || q.question.trim() === '') {
    errors.push(`Pregunta ${index + 1}: Texto vacío`);
    }
    if (!Array.isArray(q.options) || q.options.length === 0) {
    errors.push(`Pregunta ${index + 1}: Opciones inválidas`);
    }
    if (q.options.length !== 2 && q.options.length !== 4) {
    errors.push(`Pregunta ${index + 1}: Debe tener 2 o 4 opciones`);
    }
    if (q.options.some(opt => !opt || opt.trim() === '')) {
    errors.push(`Pregunta ${index + 1}: Opciones vacías`);
    }
    if (typeof q.correct !== 'number' || q.correct < 0 || q.correct >= q.options.length) {
    errors.push(`Pregunta ${index + 1}: Índice de respuesta correcta inválido`);
    }
    });
    
    if (errors.length > 0) {
    console.error('Errores en la estructura de preguntas:', errors);
    return false;
    }
    return true;
    }

    function formatTime(seconds) {
    const minutes = Math.floor(seconds / 60);
    const remainingSeconds = seconds % 60;
    return `${minutes.toString().padStart(2, '0')}:${remainingSeconds.toString().padStart(2, '0')}`;
    }

    function showToast(message, type = 'error') {
    const toast = document.getElementById('toast');
    toast.textContent = message;
    toast.className = `toast ${type}`;
    toast.classList.add('show');
    
    setTimeout(() => {
    toast.classList.remove('show');
    }, 5000);
    }

    function updateProgress() {
    const answered = Object.keys(userAnswers).length;
    const percentage = (answered / CONFIG.TOTAL_QUESTIONS) * 100;
    
    document.getElementById('progressBar').style.width = `${percentage}%`;
    document.getElementById('progressText').textContent = `${answered}/${CONFIG.TOTAL_QUESTIONS} preguntas respondidas`;
    }

    function updateTimer() {
    const now = Date.now();
    const elapsed = Math.floor((now - startTime) / 1000);
    timeRemaining = Math.max(0, CONFIG.DURATION - elapsed);
    
    document.getElementById('timer').textContent = formatTime(timeRemaining);
    
    // Alertas de tiempo
    if (timeRemaining === 120) { // 2 minutos
    showToast('⚠️ Quedan 2 minutos para finalizar', 'warning');
    } else if (timeRemaining === 60) { // 1 minuto
    showToast('⚠️ Queda 1 minuto para finalizar', 'warning');
    }
    
    if (timeRemaining <= 0) {
    clearInterval(timerInterval);
    showToast('⏰ Tiempo agotado. Enviando respuestas automáticamente...', 'error');
    setTimeout(() => submitQuiz(true), 2000);
    }
    }

    function renderQuestions() {
    const container = document.getElementById('questionsContainer');
    container.innerHTML = '';
    
    shuffledQuestions.forEach((q, index) => {
    const questionDiv = document.createElement('div');
    questionDiv.className = 'question';
    questionDiv.innerHTML = `
    <div class="question-title">
    <span class="question-number">${index + 1}</span>
    ${escapeHTML(q.question)}
    </div>
    <div class="options">
    ${q.shuffledOptions.map((option, optIndex) => `
    <div class="option">
    <input type="radio" 
    id="q${index}_${optIndex}" 
    name="question_${index}" 
    value="${optIndex}"
    ${!isSubmitted ? 'required' : 'disabled'}>
    <label for="q${index}_${optIndex}">${escapeHTML(option)}</label>
    </div>
    `).join('')}
    </div>
    `;
    container.appendChild(questionDiv);
    });
    
    // Agregar event listeners
    container.addEventListener('change', (e) => {
    if (e.target.type === 'radio' && !isSubmitted) {
    const questionIndex = parseInt(e.target.name.split('_')[1]);
    userAnswers[questionIndex] = parseInt(e.target.value);
    updateProgress();
    }
    });
    }

    function calculateScore() {
    let correct = 0;
    
    shuffledQuestions.forEach((q, index) => {
    const userAnswer = userAnswers[index];
    if (userAnswer !== undefined) {
    const selectedOriginalIndex = q.optionMapping[userAnswer];
    if (selectedOriginalIndex === q.correct) {
    correct++;
    }
    }
    });
    
    const score = correct * CONFIG.POINTS_PER_QUESTION;
    const percentage = (correct / CONFIG.TOTAL_QUESTIONS) * 100;
    
    return { score, correct, percentage };
    }

    function getScoreClassification(score) {
    if (score >= 4.5) return { class: 'excellent', text: 'EXCELENTE' };
    if (score >= 4.0) return { class: 'good', text: 'SOBRESALIENTE' };
    if (score >= 3.0) return { class: 'acceptable', text: 'ACEPTABLE' };
    if (score >= 2.0) return { class: 'insufficient', text: 'INSUFICIENTE' };
    return { class: 'deficient', text: 'DEFICIENTE' };
    }

    function showResults(results) {
    const { score, correct, percentage } = results;
    const classification = getScoreClassification(score);
    const passed = score >= CONFIG.PASSING_GRADE;
    
    document.getElementById('scoreValue').textContent = score.toFixed(1);
    document.getElementById('scoreValue').className = `score-value score-${classification.class}`;
    document.getElementById('scoreStatus').textContent = classification.text;
    document.getElementById('scoreDetails').innerHTML = `
    ${correct}/${CONFIG.TOTAL_QUESTIONS} respuestas correctas (${percentage.toFixed(1)}%)<br>
    Estado: <strong>${passed ? 'APROBADO' : 'REPROBADO'}</strong>
    `;
    
    document.getElementById('results').classList.add('show');
    document.getElementById('results').scrollIntoView({ behavior: 'smooth' });
    }

    function showFeedback() {
    shuffledQuestions.forEach((q, index) => {
    const userAnswer = userAnswers[index];
    const options = document.querySelectorAll(`input[name="question_${index}"]`);
    
    options.forEach((option, optIndex) => {
    const optionDiv = option.closest('.option');
    const selectedOriginalIndex = q.optionMapping[optIndex];
    
    if (selectedOriginalIndex === q.correct) {
    optionDiv.classList.add('correct');
    } else if (userAnswer === optIndex) {
    optionDiv.classList.add('incorrect');
    }
    
    option.disabled = true;
    });
    });
    }

    function generateReport(results) {
    const { score, correct, percentage } = results;
    const classification = getScoreClassification(score);
    const passed = score >= CONFIG.PASSING_GRADE;
    const studentName = document.getElementById('studentName').value;
    const endTime = new Date();
    const timeUsed = CONFIG.DURATION - timeRemaining;
    
    let report = `REPORTE DE EVALUACIÓN - CUESTIONARIO HTML Y CSS
====

INFORMACIÓN DEL ESTUDIANTE:
Nombre: ${studentName}
Fecha: ${endTime.toLocaleDateString('es-ES')}
Hora: ${endTime.toLocaleTimeString('es-ES')}
Tiempo utilizado: ${formatTime(timeUsed)}

RESULTADOS:
Puntuación: ${score.toFixed(1)}/5.0
Respuestas correctas: ${correct}/${CONFIG.TOTAL_QUESTIONS}
Porcentaje de acierto: ${percentage.toFixed(1)}%
Clasificación: ${classification.text}
Estado: ${passed ? 'APROBADO' : 'REPROBADO'}

====
DETALLE DE RESPUESTAS:
====

`;

    shuffledQuestions.forEach((q, index) => {
    const userAnswer = userAnswers[index];
    const userAnswerText = userAnswer !== undefined ? q.shuffledOptions[userAnswer] : 'No respondida';
    const correctAnswerText = q.options[q.correct];
    const isCorrect = userAnswer !== undefined && q.optionMapping[userAnswer] === q.correct;
    
    report += `PREGUNTA ${index + 1}:
${q.question}

OPCIONES:
${q.shuffledOptions.map((opt, i) => `${String.fromCharCode(65 + i)}) ${opt}`).join('\n')}

RESPUESTA DEL ESTUDIANTE: ${userAnswerText}
RESPUESTA CORRECTA: ${correctAnswerText}
ESTADO: ${isCorrect ? '✅ CORRECTA' : '❌ INCORRECTA'}

----

`;
    });

    report += `RESUMEN ESTADÍSTICO:
Total de preguntas: ${CONFIG.TOTAL_QUESTIONS}
Respondidas correctamente: ${correct}
Respondidas incorrectamente: ${CONFIG.TOTAL_QUESTIONS - correct - (CONFIG.TOTAL_QUESTIONS - Object.keys(userAnswers).length)}
No respondidas: ${CONFIG.TOTAL_QUESTIONS - Object.keys(userAnswers).length}
Puntuación final: ${score.toFixed(1)}/5.0

====
FIN DEL REPORTE
====`;

    // Descargar reporte
    const blob = new Blob([report], { type: 'text/plain;charset=utf-8' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `Reporte_${studentName.replace(/\s+/g, '_')}_${endTime.toISOString().split('T')[0]}.txt`;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
    }

    function submitQuiz(autoSubmit = false) {
    if (isSubmitted) return;
    
    const studentName = document.getElementById('studentName').value.trim();
    if (!studentName && !autoSubmit) {
    document.getElementById('nameError').style.display = 'block';
    document.getElementById('studentName').focus();
    showToast('Por favor, ingresa tu nombre completo', 'error');
    return;
    }
    
    isSubmitted = true;
    clearInterval(timerInterval);
    
    document.getElementById('submitBtn').disabled = true;
    document.getElementById('submitBtn').textContent = 'Procesando...';
    
    const results = calculateScore();
    
    setTimeout(() => {
    showResults(results);
    showFeedback();
    generateReport(results);
    
    showToast('✅ Evaluación completada. Reporte descargado automáticamente.', 'success');
    }, 1000);
    }

    function initializeQuiz() {
    if (!validateQuestions()) {
    showToast('Error en la configuración del cuestionario', 'error');
    return;
    }
    
    // Mezclar preguntas
    shuffledQuestions = shuffleArray(questions).slice(0, CONFIG.TOTAL_QUESTIONS);
    
    // Mezclar opciones manteniendo coherencia
    shuffledQuestions = shuffledQuestions.map(q => {
    const optionsWithIndex = q.options.map((option, index) => ({ option, originalIndex: index }));
    const shuffledOptionsWithIndex = shuffleArray(optionsWithIndex);
    
    return {
    ...q,
    shuffledOptions: shuffledOptionsWithIndex.map(item => item.option),
    optionMapping: shuffledOptionsWithIndex.reduce((mapping, item, newIndex) => {
    mapping[newIndex] = item.originalIndex;
    return mapping;
    }, {})
    };
    });
    
    renderQuestions();
    
    // Iniciar temporizador
    startTime = Date.now();
    timerInterval = setInterval(updateTimer, 1000);
    
    // Event listeners
    document.getElementById('submitBtn').addEventListener('click', () => submitQuiz(false));
    
    // Ocultar mensaje de error al escribir
    document.getElementById('studentName').addEventListener('input', () => {
    document.getElementById('nameError').style.display = 'none';
    });
    
    console.log('Cuestionario inicializado correctamente');
    }

    // Inicializar cuando el DOM esté listo
    document.addEventListener('DOMContentLoaded', initializeQuiz);
    </script>
</body>
</html>